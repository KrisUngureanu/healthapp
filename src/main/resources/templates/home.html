<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout.html}">
<head>
    <title>Пациенты</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root{
            --grad-a:#4364f7; --grad-b:#6fb1fc;
        }
        .btn-gradient{ background:linear-gradient(90deg,var(--grad-a),var(--grad-b)); border:none; color:#fff }
        .btn-gradient:hover{ background:linear-gradient(90deg,var(--grad-b),var(--grad-a)); color:#fff }
        .btn-soft{ background:#f0f3ff; border:1px solid #e1e6ff; color:#3042c7 }
        .btn-soft:hover{ background:#e6ebff; color:#2132a7 }

        /* Компактная карточка */
        .patient-card{
            border:none; border-radius:.9rem; box-shadow:0 6px 16px rgba(0,0,0,.08);
            overflow:hidden; height:auto;
        }
        .patient-card .card-body{ padding:.9rem .9rem }
        .patient-card .name{ font-weight:600; font-size:1rem; line-height:1.2 }
        .patient-card .meta{ font-size:.8rem; color:#6c757d }
        .patient-card .actions{ display:flex; gap:.5rem }
        .status-dot{ width:.6rem; height:.6rem; border-radius:50%; display:inline-block; margin-right .4rem }
        .status-active{ background:#20c997 }     /* teal */
        .status-critical{ background:#dc3545 }   /* red */
        .status-default{ background:#6c757d }    /* gray */
        .avatar{
            width:36px; height:36px; border-radius:50%;
            display:flex; align-items:center; justify-content:center;
            background:linear-gradient(90deg,var(--grad-a),var(--grad-b)); color:#fff; font-weight:700;
            box-shadow:0 2px 8px rgba(67,100,247,.25);
            flex:none;
        }
        /* Сетка: компактные плитки */
        .grid{ row-gap:12px }
        @media (min-width: 576px){
            .grid>[class*="col-"]{ padding-right:8px; padding-left:8px }
        }
    </style>
</head>
<body>
<div layout:fragment="mainFragment">

    <!-- Верхняя панель -->
    <div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
        <h3 class="mb-0">Мои пациенты</h3>
        <div class="d-flex gap-2">

            <a class="btn btn-gradient btn-sm" th:href="@{/patients/new}">Добавить пациента</a>
        </div>
    </div>

    <!-- Пустое состояние -->
    <div th:if="${#lists.isEmpty(patients)}" class="text-center py-5">
        <h5 class="mb-2">Пока нет пациентов</h5>
        <p class="text-muted mb-3">Нажмите «Добавить пациента», чтобы пригласить первого спортсмена.</p>
    </div>

    <!-- Список пациентов -->
    <div th:if="${!#lists.isEmpty(patients)}"
         class="row grid row-cols-1 row-cols-sm-2 row-cols-lg-3 row-cols-xxl-4">
        <div class="col patient-item" th:each="p : ${patients}"
             th:attr="data-name=${#strings.toLowerCase(p.fullname)}">
            <div class="card patient-card">
                <div class="card-body">

                    <!-- Верхняя строка: аватар, имя, статус-точка -->
                    <div class="d-flex align-items-start justify-content-between">
                        <div class="d-flex align-items-center gap-2">
                            <div class="avatar"
                                 th:text="${#strings.substring(p.fullname,0,1)}">A</div>
                            <div>
                                <div class="name" th:text="${p.fullname}">Иванов Иван</div>
                                <div class="meta">
                                    <span class="text-muted">ID:</span>
                                    <span th:text="${p.id}">1</span>
                                </div>
                            </div>
                        </div>

                        <div th:with="st=${(p.status?:'').toLowerCase()}">
           <span class="badge status-badge"
                 th:with="st=${(p.status ?: '').toLowerCase()}"
                 th:text="${st != '' ? p.status : '—'}"
                 th:classappend="${st == 'active'} ? ' bg-success'
                      : (st == 'critical' ? ' bg-danger' : ' bg-secondary')">
  Статус
</span>
                        </div>
                    </div>

                    <!-- Кнопки -->
                    <div class="d-flex justify-content-between align-items-center mt-3">

                        <div class="actions">
                            <a class="btn btn-soft btn-sm"
                               th:href="@{'/patients/' + ${p.id}}">Подробнее</a>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

</div>

<script>
    function filterPatients(q){
        q = (q||'').trim().toLowerCase();
        const items = document.querySelectorAll('.patient-item');
        items.forEach(el=>{
            const name = el.getAttribute('data-name') || '';
            el.style.display = name.indexOf(q) >= 0 ? '' : 'none';
        });
    }
</script>
</body>
</html>
